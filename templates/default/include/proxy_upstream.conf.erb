
upstream <%= @name %> {
  <% @configs['backends'].each do |backend| %>
  server <%= backend %><% if @configs['backend_params'] %><%= hash_to_s(@configs['backend_params']) %><% end %>;
  <% Hash(@configs['backend_configs']).each do |k,v| %>
  <%= k %> <%= v %>;
  <% end %>
}

location <%= @configs['location'] %> {
  <% Hash(@configs['location_configs']).each do |k,v| %>
  <%= k %> <%= v %>;
  <% end %>
  proxy_set_header Host $host;
  proxy_set_header X-Real-IP $remote_addr;
  <% Hash(@configs['proxy_headers']).each do |k,v| %>
  proxy_set_header <%= k %> <%= v %>;
  <% end %>
  proxy_pass "http://<%= @name %>/";
}
