# Standard FastCGI parameters
#
fastcgi_param QUERY_STRING    $query_string;
fastcgi_param REQUEST_METHOD  $request_method;
fastcgi_param CONTENT_TYPE    $content_type;
fastcgi_param CONTENT_LENGTH  $content_length;

fastcgi_param SCRIPT_FILENAME $request_filename;
fastcgi_param SCRIPT_NAME     $fastcgi_script_name;
fastcgi_param REQUEST_URI     $request_uri;
fastcgi_param DOCUMENT_URI    $document_uri;
fastcgi_param DOCUMENT_ROOT   $document_root;
fastcgi_param SERVER_PROTOCOL $server_protocol;

fastcgi_param REMOTE_ADDR     $remote_addr;
fastcgi_param SERVER_ADDR     $server_addr;
fastcgi_param SERVER_PORT     $server_port;
fastcgi_param SERVER_NAME     $server_name;

fastcgi_param REDIRECT_STATUS 200;

fastcgi_param GATEWAY_INTERFACE CGI/1.1;
fastcgi_param SERVER_SOFTWARE nginx/$nginx_version;

# Define the default PHP index file
# * Begins with a / for compatibility
#
set $fsn <%= @configs['default_index'] %>;

# Ensure that FastCGI script is below the document root
#
if (-f $document_root$fastcgi_script_name) {
  set $fsn $fastcgi_script_name;
}

fastcgi_param SCRIPT_FILENAME $document_root$fsn;
fastcgi_param PATH_TRANSLATED $document_root$fsn;

# Preserve pathinfo and set fastcgi default
#
fastcgi_index index.php;
fastcgi_split_path_info ^(.+?\.php)(/.*)$;
fastcgi_param PATH_INFO $fastcgi_path_info;

# Custom FastCGI params
#
<% @configs['fastcgi_params'].each do |key, value| %>
fastcgi_param <%= key %> <%= value %>;
<% end %>
